// TODO
// - icon sizing?

// defaults
@layer derived
	.bunt-button, .bunt-link-button
		--_button-color: var(--button-color, var(--clr-primary))
		--_button-color-error: var(--button-color-error, var(--clr-danger))
		--_button-color-success: var(--button-color-success, var(--clr-success))

$button-height = 36px

$hover-lightness = 0.786
$pressed-lightness = 0.607

$hover-alpha = 0.08
$pressed-alpha = 0.12

bunt-lightness(color, amount)
	return unquote('hsl(var(' + color + '-h), var(' + color + '-s), calc(var(' + color + '-l) * ' + amount + '))')

bunt-alpha(color, alpha)
	return unquote('hsla(var(' + color + '-h), var(' + color + '-s), var(' + color + '-l), ' + alpha + ')')

button()
	.bunt-button, a.bunt-button
		font-family: $font-stack
		font-size: 14px
		text-transform: capitalize
		font-weight: 500
		line-height: $button-height
		vertical-align: middle
		flex-shrink: 0
		outline: none
		border: none

		position: relative
		display: inline-flex
		align-items: center
		justify-content: center
		
		cursor: pointer

		border-radius: 100vmax // yolo
		padding: 0 16px
		min-width: 80px
		height: $button-height
		white-space: nowrap // buttons can't be multiline

		background-color: var(--_button-color)
		color: var(--_button-text-color)

		.bunt-button-content
			display: flex

		.bunt-icon
			font-size: 20px
			padding-right: 8px

			&.error, &.success
				position: absolute

		&.with-icon
			padding: 0 16px 0 12px

		&.icon-only
			padding: 0
			min-width: 0
			width: $button-height
			.bunt-icon
				padding-right: 0

		&:hover
			background-color: bunt-lightness(--_button-bg, $hover-lightness)
			color: var(--_button-text-color) // guard against rogue vitepress css

		&:active
			background-color: bunt-lightness(--_button-bg, $pressed-lightness)

		&:focus-visible
			outline-style: solid
			background-color: bunt-lightness(--_button-bg, $hover-lightness)
			outline-color: bunt-lightness(--_button-bg, 0.75)
			outline-width: 2px
			outline-offset: 2px

		&.disabled
			cursor: default
			.bunt-button-content
				opacity: 0.6

		// hide normal content when showing other content
		&.loading, &.success
			cursor: default
		&.loading, &.success, &.error
			.bunt-button-content
				visibility: hidden

		.bunt-progress-circular
			--progress-size: small
			position: absolute
			top: 50%
			left: 50%
			animation: button-container-rotate 1568ms linear infinite
			@keyframes button-container-rotate
				from
					transform: translate(-50%, -50%) rotate(0deg)
				to
					transform: translate(-50%, -50%) rotate(360deg)
			svg circle
				stroke: currentColor

		&.success
			background-color: var(--_button-color-success)
			&:hover
				background-color: bunt-lightness(--_button-bg-success, $hover-lightness)
			&:focus-visible
				background-color: bunt-lightness(--_button-bg-success, $hover-lightness)
				outline-color: bunt-lightness(--_button-bg-success, 0.75)

		&.error
			background-color: var(--_button-color-error)
			&:hover
				background-color: bunt-lightness(--_button-bg-error, $hover-lightness)
			&:focus-visible
				background-color: bunt-lightness(--_button-bg-error, $hover-lightness)
				outline-color: bunt-lightness(--_button-bg-error, 0.75)
			.bunt-tooltip
				background-color: var(--_button-color-error)

	.bunt-button--shape-squared
		border-radius: 0

	.bunt-button--shape-rounded
		border-radius: 4px

	.bunt-button--weight-outlined, .bunt-button--weight-text
		background-color: transparent
		color: var(--_button-color)
		&:hover
			background-color: bunt-alpha(--_button-bg, $hover-alpha)
			color: var(--_button-color) // guard against rogue vitepress css
		&:active, &:focus-visible
			background-color: bunt-alpha(--_button-bg, $pressed-alpha)
		&.success
			background-color: transparent
			border-color: var(--_button-color-success)
			color: var(--_button-color-success)
			&:hover
				background-color: bunt-alpha(--_button-bg-success, $hover-alpha)
			&:active, &:focus-visible
				background-color: bunt-alpha(--_button-bg-success, $pressed-alpha)
		&.error
			background-color: transparent
			border-color: var(--_button-color-error)
			color: var(--_button-color-error)
			&:hover
				background-color: bunt-alpha(--_button-bg-error, $hover-alpha)
			&:active, &:focus-visible
				background-color: bunt-alpha(--_button-bg-error, $pressed-alpha)
	
	.bunt-button--weight-outlined
		border: 1px solid var(--_button-color)

	// TODO grey text for disabled?

	.bunt-button--size-large
		font-size: 16px
		height: 40px
		line-height: @height
		padding: 0 64px
		.bunt-icon
			font-size: 24px
			padding-right: 16px
		&.with-icon
			padding: 0 64px 0 32px
		&.icon-only
			width: 40px
			padding: 0
	.bunt-button--size-huge
		font-size: 18px
		height: 48px
		line-height: @height
		padding: 8px 64px
		.bunt-icon
			font-size: 28px
			padding-right: 16px
		&.with-icon
			padding: 0 64px 0 32px
		&.icon-only
			width: 48px
			padding: 0
